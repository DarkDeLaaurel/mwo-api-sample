<?xml version="1.0" encoding="ISO-8859-1"?>

<product productid="smurfy_bbcode_mechlab" active="1">
    <title><![CDATA[smurfy mechlab BBCode]]></title>
    <description><![CDATA[Adds [smurfy] BBCode to Vbulletin]]></description>
    <version>0.0.1</version>
    <url>http://mwo.smurfy-net.de</url>
    <versioncheckurl />
    <dependencies>
        <dependency dependencytype="vbulletin" minversion="3.7.0" maxversion="" />
    </dependencies>
    <codes>
    </codes>
    <templates>
    </templates>
    <plugins>
        <plugin active="1" executionorder="5">
            <title>Strip tag in previews etc</title>
            <hookname>strip_bbcode</hookname>
            <phpcode><![CDATA[

$block_elements[] = 'smurfy';

            ]]></phpcode>
        </plugin>
        <plugin active="1" executionorder="5">
            <title>Creation of the tag itself in the bbcodecache</title>
            <hookname>bbcode_create</hookname>
            <phpcode><![CDATA[

$this->unparsed_tags[] = 'smurfy';

function smurfy_handle_bbcode(&$registry, $code, $title = null) {
	$url = $registry->strip_front_back_whitespace($code, 1);
    $html = '';
    $result = preg_match('/i=(\d+)&l=(\w+)/',$url, $matches);
    if($result === 1) {
        $html = '<iframe src="http://mwo.smurfy-net.de/tools/mechtooltip?i=' . $matches[1] . '&l=' . $matches[2] . '" width="100%" height="300"></iframe>';
    }
    return $html;
}

]]></phpcode>
        </plugin>
        <plugin active="1" executionorder="5">
            <title>fetch proper bbcode tags</title>
            <hookname>bbcode_fetch_tags</hookname>
            <phpcode><![CDATA[

$tag_list['no_option']['smurfy'] = array(
	'callback' => 'handle_external',
	'strip_empty' => true,
	'stop_parse' => true,
	'disable_smilies' => true,
	'disable_wordwrap' => true,
	'strip_space_after' => 2,
	'external_callback' => 'smurfy_handle_bbcode'
);

$tag_list['option']['smurfy'] = array(
	'callback' => 'handle_external',
	'strip_empty' => true,
	'stop_parse' => true,
	'disable_smilies' => true,
	'disable_wordwrap' => true,
	'strip_space_after' => 2,
	'external_callback' => 'smurfy_handle_bbcode'
);

]]></phpcode>
        </plugin>
    </plugins>
    <phrases>
    </phrases>
    <options>
    </options>
    <helptopics>
    </helptopics>
    <cronentries>
    </cronentries>
    <faqentries>
    </faqentries>
</product>